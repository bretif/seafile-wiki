== Enable https on Seahub (Nginx)==

Note: Seafile has two web components, Seahub and HttpServer. Seahub is to serve normal web pages and Http-server is to serve only raw file uploading/downloading. You need set both parts to use https. 


Here we use self-signed SSL digital certificate for free. If you use a paid ssl certificate from some authority, just skip the first step.

* Generate SSL digital certificate with OpenSSL
<pre>
    openssl genrsa -out privkey.pem 2048
    openssl req -new -x509 -key privkey.pem -out cacert.pem -days 1095
</pre>

* Enable SSL module of Nginx (optional)
If your Nginx does not support SSL, you need to recompile it, the commands are as follows:
<pre>
    ./configure --with-http_stub_status_module --with-http_ssl_module
    make && make install
</pre>

* Modify Nginx configuration file

Assume you have configured nginx as [[Deploy-Seafile-Web-with-nginx-apache]]. To use https, you need to modify your nginx configuration file.
<pre>
    server {
        listen       80;
        server_name  www.yourdoamin.com; 
        rewrite ^/(.*) https://$server_name/$1 permanent;
        }
    server
    {
    listen 443;
    ssl on;
    ssl_certificate /etc/ssl/cacert.pem;	# path to your cacert.pem
    ssl_certificate_key /etc/ssl/privkey.pem;	# path to your privkey.pem
    server_name www.yourdoamin.com;    
    ......
    ......
    fastcgi_param   HTTPS   on;
    }
</pre>
* Reload Nginx
<pre>
    nginx -s reload
</pre>

* Force redirect http to https
<pre>
    server
    {
    listen 443;
    ssl on;
    ssl_certificate /etc/ssl/cacert.pem;	# path to your cacert.pem
    ssl_certificate_key /etc/ssl/privkey.pem;	# path to your privkey.pem
    server_name www.yourdoamin.com;    
    ......
    ......
    fastcgi_param   HTTPS   on;
    fastcgi_param HTTP_SCHEME https;
    }
</pre>

* Test Https

Open your browser, and input https://www.yourdomain.com, if you see a security alert dialog, that means Https is enabled.

== Enable https on Seahub (Apache)==
* Modify Apache configuration file

Assume you have configured Apache as [[Deploy-Seafile-Web-with-nginx-apache]]. To use https, you need to modify your Apache configuration file.
<pre>
  LoadModule ssl_module modules/mod_ssl.so
  LoadModule fastcgi_module modules/mod_fastcgi-2.4.6-AP22.dll
  LoadModule rewrite_module modules/mod_rewrite.so
  <VirtualHost *:443>
    ServerName www.yourdoamin.com; 
    DocumentRoot E:/seafile-server-1.7.1/seahub
    Alias /media  E:/seafile-server-1.7.1/seahub/media
    RewriteEngine On
    SSLEngine On 
    SSLCertificateFile "E:/seafile-server-1.7.1/cacert.pem" 
    SSLCertificateKeyFile "E:/seafile-server-1.7.1//privkey.pem"
    RewriteRule ^/(media.*)$ /$1 [QSA,L,PT]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^(.*)$ /seahub.fcgi/$1 [QSA,L,E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
  </virtualhost>
</pre>

== Enable https on seafile httpserver ==

There are two ways of enabling https on seafile httpserver. You can either:

* Use the https support provided by httpserver itself
* Or you can deploy httpserver behind nginx/apache, and use https support provided by nginx/apache

The second method is recommended, since the https support provided by httpserver has some subtle bugs, and may be removed in a future relase.

=== Enable https on httpserver with Nginx/Apache ===

This is the recommended way.

* follow the instructions on [https://github.com/haiwen/seafile/wiki/Deploy-Seafile-Web-with-nginx-apache#deploy-httpserver-behind-nginxapache Deploy httpserver behind nginx/apache].
* since you have setup nginx/apache to use https when you setup https support for Seahub, there's nothing more to do.

=== Enable https on httpserver with https support provided itself ===

'''Note''': This method should be considered deprecated.

The configuration of seafile httpserver is in the file <code>seafile-data/seafile.conf</code>. To use the native https support of seafile httpserver, add the following lines to <code>seafile.conf</code>:
<pre>
[httpserver]
port=8082
https=true
pemfile=/path/to/pemfile
privkey=/path/to/privkey
</pre>

8082 is the recommended port, but you can use any port number that is available.

After modified <code>seafile.conf</code>, you need to restart seafile by <code>./seafile.sh restart</code>.
Then open your browser and input <code>https://www.yourdomain.com:8082</code>(assume port is 8082), you should see a blank page without any errors.

'''Note:''' If your key file is encrypted, you need to decrypt first.

== Modify settings to use https ==

=== ccnet conf ===

Since you change from http to https, you need to modify the value of "SERVICE_URL" in <code>ccnet/ccnet.conf</code>:
<pre>
SERVICE_URL = https://www.yourdoamin.com
</pre>